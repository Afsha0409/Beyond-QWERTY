{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <div id="alerts-container"></div>
    <div id="loader" style="display: none;" class="alert alert-info"></div>

    <div class="card">
        <div class="card-header">
            <h2>{{ 'Edit Form' if form else 'Create New Form' }}</h2>
        </div>
        <div class="card-body">
            <form id="form-builder">
                {% if form %}
                <input type="hidden" id="form-id" value="{{ form.id }}">
                {% endif %}

                <div class="mb-3">
                    <label for="form-title" class="form-label">Form Title</label>
                    <input type="text" class="form-control" id="form-title" value="{{ form.title if form else '' }}" required>
                </div>

                <div class="mb-3">
                    <label for="form-description" class="form-label">Form Description</label>
                    <textarea class="form-control" id="form-description" rows="3">{{ form.description if form else '' }}</textarea>
                </div>

                <div class="mb-3">
                    <label for="form-theme" class="form-label">Theme</label>
                    <select class="form-control" id="form-theme">
                        <option value="default" {% if not form or form.theme == 'default' %}selected{% endif %}>Default</option>
                        <option value="dark" {% if form and form.theme == 'dark' %}selected{% endif %}>Dark</option>
                        <option value="light" {% if form and form.theme == 'light' %}selected{% endif %}>Light</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">Form Fields</label>
                    <div id="form-fields" class="border rounded p-3">
                        <!-- Fields will be dynamically added here -->
                    </div>
                </div>

                <div class="mb-3">
                    <button type="button" id="add-field-btn" class="btn btn-secondary">Add Field</button>
                    <button type="button" id="generate-form-btn" class="btn btn-info">Generate with AI</button>
                </div>

                <div class="d-flex justify-content-between">
                    <button type="button" id="preview-form-btn" class="btn btn-secondary">Preview</button>
                    <button type="button" id="save-form-btn" class="btn btn-primary">Save Form</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Field Template Modal -->
<div class="modal fade" id="field-modal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Field</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="field-label" class="form-label">Field Label</label>
                    <input type="text" class="form-control" id="field-label" required>
                </div>
                <div class="mb-3">
                    <label for="field-type" class="form-label">Field Type</label>
                    <select class="form-control" id="field-type">
                        <option value="text">Text</option>
                        <option value="textarea">Text Area</option>
                        <option value="number">Number</option>
                        <option value="email">Email</option>
                        <option value="tel">Phone</option>
                        <option value="select">Dropdown</option>
                        <option value="radio">Radio Buttons</option>
                        <option value="checkbox">Checkboxes</option>
                    </select>
                </div>
                <div class="mb-3">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="field-required">
                        <label class="form-check-label" for="field-required">Required</label>
                    </div>
                </div>
                <div id="options-container" class="mb-3" style="display: none;">
                    <label class="form-label">Options</label>
                    <div id="field-options"></div>
                    <button type="button" class="btn btn-sm btn-secondary mt-2" id="add-option-btn">Add Option</button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="save-field-btn">Add Field</button>
            </div>
        </div>
    </div>
</div>

{% if form %}
<script>
    // Pass form data to JavaScript
    window.formData = JSON.parse('{{ form|tojson|safe }}');
</script>
{% else %}
<script>
    window.formData = null;
</script>
{% endif %}

<!-- Include form builder JavaScript -->
<script src="{{ url_for('static', filename='js/create.js') }}"></script>
{% endblock %}